name: üîß Build Windows Application
on:
  pull_request:
  push:
    branches: [BabinTest, main]
  workflow_dispatch:

jobs:
  build-windows:
    runs-on: windows-latest
    steps:
      - name: Checkout source code
        uses: actions/checkout@v4

      - name: Setup Visual Studio (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
        uses: microsoft/setup-msbuild@v2
        with:
          vs-version: '2022'

      - name: Install Qt with MSVC
        uses: jurplel/install-qt-action@v4
        with:
          version: '6.9.3'
          host: windows
          target: desktop
          arch: win64_msvc2022_64
          cache: true

      - name: Build with MSVC (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
        shell: cmd
        run: |
          echo üèóÔ∏è Building with MSVC...
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ MSVC –¥–æ—Å—Ç—É–ø–µ–Ω
          cl.exe
          nmake.exe
          qmake.exe -version
          
          echo üî® Running qmake...
          qmake.exe ComputerAlgebraSystem.pro -spec win32-msvc "CONFIG+=release"
          
          echo üî® Running nmake...
          nmake.exe
          
          echo ‚úÖ Build completed

      - name: Verify binary
        run: |
          if (Test-Path "release\ComputerAlgebraSystem.exe") {
            echo "‚úÖ Binary found in release folder"
            copy release\ComputerAlgebraSystem.exe .\
          } elseif (Test-Path "ComputerAlgebraSystem.exe") {
            echo "‚úÖ Binary found in root folder"
          } else {
            echo "‚ùå Binary not found"
            Get-ChildItem -Recurse -Include *.exe
            exit 1
          }

      - name: Upload binary
        uses: actions/upload-artifact@v4
        with:
          name: ComputerAlgebraSystem-Windows.exe
          path: ComputerAlgebraSystem.exe
          retention-days: 30