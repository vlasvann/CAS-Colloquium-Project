name: üîß Build Windows Application
on:
  pull_request:
  push:
    branches: [BabinTest, main]
  workflow_dispatch:

jobs:
  build-windows:
    runs-on: windows-latest
    steps:
      - name: Checkout source code
        uses: actions/checkout@v4

      - name: Install Qt
        uses: jurplel/install-qt-action@v4
        with:
          version: '6.9.3'
          host: windows
          target: desktop
          arch: win64_mingw
          cache: true

      - name: Build with qmake (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
        shell: bash
        run: |
          echo "üèóÔ∏è Building with qmake..."
          
          # –ò—Å–ø–æ–ª—å–∑—É–µ–º bash –∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—É—Ç–∏
          export PATH="/c/Qt/6.9.3/mingw_64/bin:$PATH"
          
          echo "üîß Checking tools..."
          which qmake
          which g++
          which mingw32-make
          
          qmake --version
          g++ --version
          
          echo "üî® Running qmake..."
          qmake ComputerAlgebraSystem.pro -spec win32-g++
          
          echo "üî® Running make..."
          mingw32-make
          
          echo "‚úÖ Build completed"

      - name: Verify binary
        run: |
          echo "üîç Looking for binary..."
          if [ -f "release/ComputerAlgebraSystem.exe" ]; then
            echo "‚úÖ Binary found in release folder"
            cp release/ComputerAlgebraSystem.exe .
          elif [ -f "ComputerAlgebraSystem.exe" ]; then
            echo "‚úÖ Binary found in root folder"
          else
            echo "‚ùå Binary not found"
            find . -name "*.exe" -type f
            exit 1
          fi

      - name: Upload binary
        uses: actions/upload-artifact@v4
        with:
          name: ComputerAlgebraSystem-Windows.exe
          path: ComputerAlgebraSystem.exe
          retention-days: 30