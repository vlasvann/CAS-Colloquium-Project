name: Build Computer Algebra System

on:
  push:
    branches: [BabinTest, main]
  pull_request:
    branches: [BabinTest, main]

jobs:
  build-linux:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Install Qt and build
      run: |
        sudo apt-get update
        sudo apt-get install -y qt6-base-dev g++ make
        qmake6 ComputerAlgebraSystem.pro || qmake ComputerAlgebraSystem.pro
        make -j4
        cp build/ComputerAlgebraSystem .
        
    - name: Upload Linux binary
      uses: actions/upload-artifact@v4
      with:
        name: ComputerAlgebraSystem-Linux
        path: ComputerAlgebraSystem

  build-windows:
    runs-on: windows-latest
    continue-on-error: true  # Пропускаем если не соберётся
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Build with MSVC (последняя попытка)
      shell: cmd
      run: |
        echo Просто пытаемся собрать...
        "C:\Program Files\Microsoft Visual Studio\2022\Enterprise\VC\Auxiliary\Build\vcvars64.bat"
        qmake ComputerAlgebraSystem.pro
        nmake || echo "Сборка не удалась, но продолжаем"
        
    - name: Upload если получилось
      if: success()
      uses: actions/upload-artifact@v4
      with:
        name: ComputerAlgebraSystem-Windows.exe
        path: release/ComputerAlgebraSystem.exe
        if-no-files-found: ignore