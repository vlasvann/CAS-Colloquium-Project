name: Build Computer Algebra System

on:
  push:
    branches: [BabinTest, main]
  pull_request:
    branches: [BabinTest, main]

jobs:
  build-linux:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Install Qt and dependencies
      run: |
        echo "üîß Installing dependencies..."
        sudo apt-get update
        sudo apt-get install -y build-essential
        sudo apt-get install -y qt6-base-dev qt6-tools-dev qt6-tools-dev-tools
        sudo apt-get install -y g++ make

    - name: Build project
      run: |
        echo "üèóÔ∏è Building project..."
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –≤—Å—ë —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
        qmake6 --version || qmake --version
        g++ --version
        make --version
        
        # –°–±–æ—Ä–∫–∞
        qmake6 ComputerAlgebraSystem.pro || qmake ComputerAlgebraSystem.pro
        make -j4
        
        echo "‚úÖ Build completed"

    - name: Verify binary
      run: |
        echo "üîç Looking for binary..."
        if [ -f "ComputerAlgebraSystem" ]; then
          echo "‚úÖ Binary found: ComputerAlgebraSystem"
          ls -la ComputerAlgebraSystem
          file ComputerAlgebraSystem
        else
          echo "‚ùå Binary not found"
          find . -name "ComputerAlgebraSystem" -type f
          echo "üìÅ All files:"
          ls -la
          exit 1
        fi
        
    - name: Upload build artifacts
      uses: actions/upload-artifact@v4
      with:
        name: ComputerAlgebraSystem-Linux
        path: ComputerAlgebraSystem
        retention-days: 30

  build-windows:
    runs-on: windows-latest
    continue-on-error: true  # ‚Üê –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –æ—à–∏–±–∫—É –µ—Å–ª–∏ Windows –Ω–µ —Å–æ–±–µ—Ä—ë—Ç—Å—è
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Install Qt
      uses: jurplel/install-qt-action@v4
      with:
        version: '6.9.3'
        host: windows
        target: desktop
        arch: win64_mingw

    - name: Try Windows build
      run: |
        echo "üîÑ Attempting Windows build..."
        C:\Qt\6.9.3\mingw_64\bin\qmake.exe ComputerAlgebraSystem.pro
        C:\Qt\6.9.3\mingw_64\bin\mingw32-make.exe || echo "Windows build failed, but continuing..."

    - name: Upload Windows artifact if exists
      if: success() || failure()
      uses: actions/upload-artifact@v4
      with:
        name: ComputerAlgebraSystem-Windows.exe
        path: ComputerAlgebraSystem.exe
        if-no-files-found: ignore