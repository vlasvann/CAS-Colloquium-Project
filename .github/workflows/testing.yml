name: Build Windows Version

on:
  push:
    branches: [BabinTest, main]

jobs:
  build-windows:
    runs-on: windows-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Install Visual Studio Build Tools
      run: |
        # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Visual Studio Build Tools
        choco install visualstudio2022buildtools -y
        choco install visualstudio2022-workload-vctools -y

    - name: Install Qt
      uses: jurplel/install-qt-action@v4
      with:
        version: '6.9.3'
        host: windows
        target: desktop
        arch: win64_msvc2022_64

    - name: Build Project
      shell: cmd
      run: |
        echo üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è...
        call "C:\Program Files\Microsoft Visual Studio\2022\BuildTools\VC\Auxiliary\Build\vcvars64.bat"
        
        echo üèóÔ∏è –ö–æ–º–ø–∏–ª—è—Ü–∏—è...
        qmake.exe ComputerAlgebraSystem.pro -spec win32-msvc
        nmake.exe
        
        echo ‚úÖ –°–±–æ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!

    - name: Create Windows Package
      run: |
        echo üì¶ –°–æ–∑–¥–∞–Ω–∏–µ –ø–∞–∫–µ—Ç–∞ –¥–ª—è Windows...
        
        # –ö–æ–ø–∏—Ä—É–µ–º –±–∏–Ω–∞—Ä–Ω–∏–∫ –µ—Å–ª–∏ –æ–Ω –≤ release/
        if (Test-Path "release\ComputerAlgebraSystem.exe") {
          copy release\ComputerAlgebraSystem.exe .
        }
        
        # –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Qt
        windeployqt.exe --release ComputerAlgebraSystem.exe
        
        # –°–æ–∑–¥–∞—ë–º –ø–∞–ø–∫—É —Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º
        mkdir ComputerAlgebraSystem_Windows
        copy ComputerAlgebraSystem.exe ComputerAlgebraSystem_Windows\
        copy *.dll ComputerAlgebraSystem_Windows\
        if (Test-Path "platforms") { copy platforms ComputerAlgebraSystem_Windows\ -Recurse }
        if (Test-Path "imageformats") { copy imageformats ComputerAlgebraSystem_Windows\ -Recurse }
        if (Test-Path "styles") { copy styles ComputerAlgebraSystem_Windows\ -Recurse }
        
        # –°–æ–∑–¥–∞—ë–º ZIP –∞—Ä—Ö–∏–≤
        Compress-Archive -Path ComputerAlgebraSystem_Windows\* -DestinationPath ComputerAlgebraSystem-Windows.zip -Force
        
        echo üéÅ –§–∞–π–ª –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Å–æ–∑–¥–∞–Ω: ComputerAlgebraSystem-Windows.zip

    - name: Upload Windows Package
      uses: actions/upload-artifact@v4
      with:
        name: ComputerAlgebraSystem-Windows.zip
        path: ComputerAlgebraSystem-Windows.zip
        retention-days: 30

    - name: Show Download Info
      run: |
        echo ""
        echo "üéâ WINDOWS –°–ë–û–†–ö–ê –ì–û–¢–û–í–ê! üéâ"
        echo "üì¶ –§–∞–π–ª: ComputerAlgebraSystem-Windows.zip"
        echo "üìç –ì–¥–µ —Å–∫–∞—á–∞—Ç—å:"
        echo "   1. –ó–∞–π–¥–∏ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–∞ GitHub"
        echo "   2. –ù–∞–∂–º–∏ –≤–∫–ª–∞–¥–∫—É 'Actions'"  
        echo "   3. –í—ã–±–µ—Ä–∏ —ç—Ç–æ—Ç –∑–∞–ø—É—Å–∫"
        echo "   4. –í–Ω–∏–∑—É –±—É–¥–µ—Ç 'Artifacts' - —Å–∫–∞—á–∞–π –æ—Ç—Ç—É–¥–∞"
        echo "   5. –†–∞—Å–ø–∞–∫—É–π ZIP –Ω–∞ –ª—é–±–æ–º Windows –∫–æ–º–ø—å—é—Ç–µ—Ä–µ"
        echo "   6. –ó–∞–ø—É—Å—Ç–∏ ComputerAlgebraSystem.exe"
        echo ""